@model List<Book>
@{
    ViewBag.Title = "Index";
}

<h2>Books</h2>

<div>
    <label>
        <input type="checkbox" name="sortByGenre" onchange="filterBooks()" /> Sort by Genre
    </label>
</div>

<div>
    <label>
        <input type="checkbox" name="sortByAuthor" onchange="filterBooks()" /> Sort by Author
    </label>
</div>

<div>
    <label>
        <input type="checkbox" name="sortByPublicationYear" onchange="filterBooks()" /> Sort by Publication Year (Descending)
    </label>
</div>

<table class="table" id="booksTable">
    <thead>
        <tr>
            <th>Genre</th>
            <th>Title</th>
            <th>Author</th>
            <th>Publication Year</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var book in Model)
        {
            <tr>
                <td>@book.Genre</td>
                <td>@book.Title</td>
                <td>@book.Author</td>
                <td>@book.PublicationYear</td>
            </tr>
        }
    </tbody>
</table>

@section scripts {
    <script>
        function filterBooks() {
            var table = document.getElementById("booksTable");
            var rows = table.getElementsByTagName("tr");
            var sortingIndex = -1;
            var isDescending = false;

            // Checkboxes
            var sortByGenre = document.getElementsByName("sortByGenre")[0].checked;
            var sortByAuthor = document.getElementsByName("sortByAuthor")[0].checked;
            var sortByPublicationYear = document.getElementsByName("sortByPublicationYear")[0].checked;

            // Reset sorting classes
            for (var i = 0; i < rows[0].getElementsByTagName("th").length; i++) {
                rows[0].getElementsByTagName("th")[i].classList.remove("asc", "desc");
            }

            // Apply sorting
            if (sortByGenre) {
                sortingIndex = 0; // Genre is at index 0
            } else if (sortByAuthor) {
                sortingIndex = 2; // Author is at index 2
            } else if (sortByPublicationYear) {
                sortingIndex = 3; // Publication Year is at index 3
                isDescending = true; // Sort by Publication Year in descending order
            }

            if (sortingIndex !== -1) {
                // Toggle sorting order
                if (rows[0].getElementsByTagName("th")[sortingIndex].classList.contains("asc")) {
                    rows[0].getElementsByTagName("th")[sortingIndex].classList.remove("asc");
                    rows[0].getElementsByTagName("th")[sortingIndex].classList.add("desc");
                    isDescending = true;
                } else {
                    rows[0].getElementsByTagName("th")[sortingIndex].classList.remove("desc");
                    rows[0].getElementsByTagName("th")[sortingIndex].classList.add("asc");
                }

                // Convert HTMLCollection to array for sorting
                var rowArray = Array.from(rows).slice(1);

                // Sort rows based on selected column
                rowArray.sort(function (a, b) {
                    var aValue = a.getElementsByTagName("td")[sortingIndex].innerText.toLowerCase();
                    var bValue = b.getElementsByTagName("td")[sortingIndex].innerText.toLowerCase();
                    if (isDescending) {
                        return bValue.localeCompare(aValue);
                    } else {
                        return aValue.localeCompare(bValue);
                    }
                });

                // Reappend sorted rows to table
                rowArray.forEach(function (row) {
                    table.appendChild(row);
                });
            }
        }
    </script>
}
